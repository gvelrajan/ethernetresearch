<!doctype html>

<html lang="en">

<head>
  <title>Accessing Kubernetes API Server Through REST API&#39;s - Ethernet Research</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Ethernet Research: Actionable information about cloud technologies at your fingertips " />
<meta name="author" content="Ganesh Velrajan" /><meta property="og:title" content="Accessing Kubernetes API Server Through REST API&#39;s" />
<meta property="og:description" content="Typically, we use Kubectl CLI utility to talk to the Kubernetes API server to create, update, delete, read any Kubernetes objects like Pods, Deployments, Services etc.
In this tutorial, I&rsquo;ll show you how to directly access the Kubernetes API server using the REST API&rsquo;s." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.ethernetresearch.com/geekzone/accessing-kubernetes-api-server-through-rest-apis/" />
<meta property="og:image" content="http://www.ethernetresearch.com/images/kubernetes/kubernetes.jpg" />
<meta property="article:published_time" content="2018-10-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-10-29T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://www.ethernetresearch.com/images/kubernetes/kubernetes.jpg"/>

<meta name="twitter:title" content="Accessing Kubernetes API Server Through REST API&#39;s"/>
<meta name="twitter:description" content="Typically, we use Kubectl CLI utility to talk to the Kubernetes API server to create, update, delete, read any Kubernetes objects like Pods, Deployments, Services etc.
In this tutorial, I&rsquo;ll show you how to directly access the Kubernetes API server using the REST API&rsquo;s."/>

<meta name="generator" content="Hugo 0.72.0" />
    

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />
  <link rel="stylesheet" href="http://www.ethernetresearch.com/fontawesome/css/all.min.css" />
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  
  
  <link rel="stylesheet" type="text/css" href="http://www.ethernetresearch.com/css/styles.css" /></head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="http://www.ethernetresearch.com/">Ethernet Research</a>
            </h1>

      <ul id="social-media">
             <li>
               <a href="https://linkedin.com/in/username" title="LinkedIn">
               <i class="fab fa-linkedin fa-lg"></i>
               </a>
             </li>
             <li>
               <a href="https://www.youtube.com/channel/UCnmHCstjZcevizOQ0qmANlw" title="Youtube">
               <i class="fab fa-youtube fa-lg"></i>
               </a>
             </li>
      </ul>
      
      <p><em>Actionable information about cloud technologies</em></p>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="http://www.ethernetresearch.com/geekzone/">
                <i class="fa-li fa  fa-lg"></i><span>GeekZone</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://www.ethernetresearch.com/articles/">
                <i class="fa-li fa  fa-lg"></i><span>Articles</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://www.ethernetresearch.com/about/">
                <i class="fa-li fa  fa-lg"></i><span>About Us</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://www.ethernetresearch.com/online-courses-training/">
                <i class="fa-li fa  fa-lg"></i><span>Online Courses</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://www.ethernetresearch.com/contact/">
                <i class="fa-li fa  fa-lg"></i><span>Contact</span>
            </a>
        </li>
        
    </ul>
</nav>


    <main>




<article>

    <h1>Accessing Kubernetes API Server Through REST API&#39;s</h1>

    
      <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2018-10-29T00:00:00Z">Oct 29, 2018</time>
        </li>
        
        
        <li>
            Categories:
            <em>
                
                    
                    <a href="http://www.ethernetresearch.com/categories/geekzone">GeekZone</a>
                
                    , 
                    <a href="http://www.ethernetresearch.com/categories/kubernetes">Kubernetes</a>
                
            </em>
        </li>
        

        
        <li>
            <em>
                
                    
                    <a href="http://www.ethernetresearch.com/tags/container">#Container</a>
                
                    , 
                    <a href="http://www.ethernetresearch.com/tags/docker">#Docker</a>
                
                    , 
                    <a href="http://www.ethernetresearch.com/tags/kubernetes">#Kubernetes</a>
                
                    , 
                    <a href="http://www.ethernetresearch.com/tags/api">#API</a>
                
            </em>
        </li>
        

        <li>5 minute read</li>
    </ul>
</aside>

    

    
<div class="featured_image">
    <a href="http://www.ethernetresearch.com/geekzone/accessing-kubernetes-api-server-through-rest-apis/" title="Accessing Kubernetes API Server Through REST API&#39;s">
        <img src="http://www.ethernetresearch.com/images/kubernetes/kubernetes.jpg">
    </a>
</div>



    <p>Typically, we use Kubectl CLI utility to talk to the Kubernetes API server to create, update, delete, read any Kubernetes objects like Pods, Deployments, Services etc.</p>
<p>In this tutorial, I&rsquo;ll show you how to directly access the Kubernetes API server using the REST API&rsquo;s.</p>
<p>Kubernetes API server can be accessed directly using the REST API&rsquo;s in two different ways.</p>
<h2 id="method-1---kubectl-proxy-mode">Method #1 - Kubectl Proxy Mode</h2>
<p>In the method, we&rsquo;ll configure Kubectl to run in a Proxy Mode, so that it will authenticate with the API Server.  We can just provide the API to the Kubectl and it will in turn forward our request to the API Server using the appropriate security tokens.</p>
<pre><code>minikube:~$ kubectl proxy --port=8080
Starting to serve on 127.0.0.1:8080
</code></pre>
<p>The above CLI is a blocking CLI call.  So it will run until your kill it using Ctrl+C</p>
<p>Next point the Curl web tool to this kubectl proxy server.  The kubectl inturn will redirect our API requests to the Kubernetes API server.</p>
<pre><code>minikube:~$ curl localhost:8080/api
{
  &quot;kind&quot;: &quot;APIVersions&quot;,
  &quot;versions&quot;: [
    &quot;v1&quot;
  ],
  &quot;serverAddressByClientCIDRs&quot;: [
    {
      &quot;clientCIDR&quot;: &quot;0.0.0.0/0&quot;,
      &quot;serverAddress&quot;: &quot;10.160.0.3:8443&quot;
    }
  ]
}
minikube:~$
</code></pre>
<p>Now, if you want to access any object within the Kubernetes Cluster then you need to get the appropriate REST API information from the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.12/">Kubernetes API Reference guide</a>.  They keep changing the location of the Kubernetes API Reference guide , frequently.  So if the above link is broken, you need to Google Search to find it again.</p>
<p>In the above guide, I looked at the section on Pod.  I&rsquo;m interested in reading the contents of a specific pod that I have created in the Kubernetes Cluster.</p>
<p><img src="http://www.ethernetresearch.com/wp-content/uploads/2018/10/Kubernetes-API-Reference-Guide.jpg" alt="Kubernetes API Reference Guide">{.aligncenter .wp-image-1216 .size-full width=&quot;992&rdquo; height=&quot;768&rdquo;}</p>
<p>The API we need to use is the following:</p>
<pre><code>/api/v1/namespaces/{namespace-name}/pods/{pod-name}
</code></pre>
<p>Now let&rsquo;s use Curl to access this API.</p>
<pre><code>minikube:~$ curl localhost:8080/api/v1/namespaces/default/pods/helloworld

{
  &quot;kind&quot;: &quot;Pod&quot;,
  &quot;apiVersion&quot;: &quot;v1&quot;,
  &quot;metadata&quot;: {
    &quot;name&quot;: &quot;helloworld&quot;,
    &quot;namespace&quot;: &quot;default&quot;,
    &quot;selfLink&quot;: &quot;/api/v1/namespaces/default/pods/helloworld&quot;,
    &quot;uid&quot;: &quot;f1857174-db41-11e8-ab3f-42010aa00003&quot;,
    &quot;resourceVersion&quot;: &quot;11847&quot;,
    &quot;creationTimestamp&quot;: &quot;2018-10-29T06:14:50Z&quot;,
    &quot;labels&quot;: {
      &quot;app&quot;: &quot;helloworld&quot;
    }
  },
  &quot;spec&quot;: {
    &quot;volumes&quot;: [
      {
        &quot;name&quot;: &quot;default-token-htj76&quot;,
        &quot;secret&quot;: {
          &quot;secretName&quot;: &quot;default-token-htj76&quot;,
          &quot;defaultMode&quot;: 420
        }
      }
    ],
    &quot;containers&quot;: [
      {
        &quot;name&quot;: &quot;helloworld&quot;,
        &quot;image&quot;: &quot;gvelrajan/helloworld:v2.0&quot;,
        &quot;ports&quot;: [
          {
            &quot;containerPort&quot;: 80,
            &quot;protocol&quot;: &quot;TCP&quot;
          }
        ],
        &quot;resources&quot;: {
          
        },
        &quot;volumeMounts&quot;: [
          {
            &quot;name&quot;: &quot;default-token-htj76&quot;,
            &quot;readOnly&quot;: true,
            &quot;mountPath&quot;: &quot;/var/run/secrets/kubernetes.io/serviceaccount&quot;
          }
        ],
        &quot;terminationMessagePath&quot;: &quot;/dev/termination-log&quot;,
        &quot;terminationMessagePolicy&quot;: &quot;File&quot;,
        &quot;imagePullPolicy&quot;: &quot;Always&quot;
      }
    ],
    &quot;restartPolicy&quot;: &quot;Always&quot;,
    &quot;terminationGracePeriodSeconds&quot;: 30,
    &quot;dnsPolicy&quot;: &quot;ClusterFirst&quot;,
    &quot;serviceAccountName&quot;: &quot;default&quot;,
    &quot;serviceAccount&quot;: &quot;default&quot;,
    &quot;nodeName&quot;: &quot;minikube&quot;,
    &quot;securityContext&quot;: {
      
    },
    &quot;schedulerName&quot;: &quot;default-scheduler&quot;,
    &quot;tolerations&quot;: [
      {
        &quot;key&quot;: &quot;node.kubernetes.io/not-ready&quot;,
        &quot;operator&quot;: &quot;Exists&quot;,
        &quot;effect&quot;: &quot;NoExecute&quot;,
        &quot;tolerationSeconds&quot;: 300
      },
      {
        &quot;key&quot;: &quot;node.kubernetes.io/unreachable&quot;,
        &quot;operator&quot;: &quot;Exists&quot;,
        &quot;effect&quot;: &quot;NoExecute&quot;,
        &quot;tolerationSeconds&quot;: 300
      }
    ]
  },
  &quot;status&quot;: {
    &quot;phase&quot;: &quot;Running&quot;,
    &quot;conditions&quot;: [
      {
        &quot;type&quot;: &quot;Initialized&quot;,
        &quot;status&quot;: &quot;True&quot;,
        &quot;lastProbeTime&quot;: null,
        &quot;lastTransitionTime&quot;: &quot;2018-10-29T06:14:50Z&quot;
      },
      {
        &quot;type&quot;: &quot;Ready&quot;,
        &quot;status&quot;: &quot;True&quot;,
        &quot;lastProbeTime&quot;: null,
        &quot;lastTransitionTime&quot;: &quot;2018-10-29T06:14:55Z&quot;
      },
      {
        &quot;type&quot;: &quot;PodScheduled&quot;,
        &quot;status&quot;: &quot;True&quot;,
        &quot;lastProbeTime&quot;: null,
        &quot;lastTransitionTime&quot;: &quot;2018-10-29T06:14:50Z&quot;
      }
    ],
    &quot;hostIP&quot;: &quot;10.160.0.3&quot;,
    &quot;podIP&quot;: &quot;172.17.0.2&quot;,
    &quot;startTime&quot;: &quot;2018-10-29T06:14:50Z&quot;,
    &quot;containerStatuses&quot;: [
      {
        &quot;name&quot;: &quot;helloworld&quot;,
        &quot;state&quot;: {
          &quot;running&quot;: {
            &quot;startedAt&quot;: &quot;2018-10-29T06:14:55Z&quot;
          }
        },
        &quot;lastState&quot;: {
          
        },
        &quot;ready&quot;: true,
        &quot;restartCount&quot;: 0,
        &quot;image&quot;: &quot;gvelrajan/helloworld:v2.0&quot;,
        &quot;imageID&quot;: &quot;docker-pullable://gvelrajan/helloworld@sha256:897f0c9ec9f26b32a258f027bde0d276954dc7bf666d34cc85106cb3430c03de&quot;,
        &quot;containerID&quot;: &quot;docker://d9751038d20c827eac9bcfa94b71256b494ac442b2822b74a51312fd1ed7653d&quot;
      }
    ],
    &quot;qosClass&quot;: &quot;BestEffort&quot;
  }
}
</code></pre>
<p>We see that our &ldquo;helloworld&rdquo; Pod, like any Kubernetes object, has a &ldquo;Spec&rdquo; which is the user expected state(intention) of the object and &ldquo;Status&rdquo; which is the current state of the object.</p>
<p>As a developer or a DevOps Engineer, you can use Kubectl as a proxy to access the API server directly via the REST API&rsquo;s.</p>
<h2 id="method-2---direct-access-using-tokens-and-certificates">Method #2 - Direct Access using Tokens and Certificates</h2>
<p>In this method, we&rsquo;ll use the Web Request Tools such as Curl to directly authenticate  with the API server.</p>
<p>First get the API server&rsquo;s IP address and TCP port using the following command.</p>
<pre><code>minikube:~$ kubectl config view
apiVersion: v1
clusters:
- cluster:
    certificate-authority: /home/gannygans/.minikube/ca.crt
    server: https://10.160.0.3:8443
  name: minikube
contexts:
- context:
    cluster: minikube
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: {}
users:
- name: minikube
  user:
    client-certificate: /home/gannygans/.minikube/client.crt
    client-key: /home/gannygans/.minikube/client.key
minikube:~$ 
</code></pre>
<p>Next we need to get the secrete token for authentication.  We&rsquo;ll use the following two command to get the information.</p>
<pre><code>$ kubectl get secrets
$ kubectl describe secret &lt;secret-name&gt;
</code></pre>
<p>We&rsquo;ll use the following single line shell script to retrieve the token from the above commands and set it in an environmental variable named &ldquo;TOKEN&rdquo;.</p>
<pre><code>minikube:~$ TOKEN=$(kubectl describe secret $(kubectl get secrets | grep ^default | cut -f1 -d ' ') | grep -E '^token' | cut -f2 -d':' | tr -d &quot; &quot;)

minikube:~$ echo $TOKEN
eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW
50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia
3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4t
aHRqNzYiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1
lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW
50LnVpZCI6IjM0MDU1MTQ1LWQwZjktMTFlOC05NDk0LTQyMDEwYWEwMDAwMyIsInN1YiI6InN5c
3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.JR1mrMxaaW1Ty22bPGh9M1PVY
1wRi85ZrDz5DYztkqhO8zaqcmUwdWeOaKtdiA4fHcAx7CRupLRXWxCWsVZ4KK-sRDq6CTNI6knz
LVvm1n0fjLLt15mY8bWdTZld1r2hKS5NEcE05XDCFOAnmjFJuHxtUq1dD4fhUM2g_EuZgZL44CK
nTtdWWmhTBNK4ejghWQeW3M7XgewS_J3-URqSUzCkWAWMAfrPYsKb_70kecm_tQuukOL72ZWbRL
333xLp5GVzXzHjBhBf5CPYOXGT-OXd4IvnkZ7vhE3kf2lE8K-fKnOjIauHl2pLFN5LapqM6IMWG
zoV6NmEv_k6E7x-Yw
</code></pre>
<p>Let&rsquo;s use the above token in the curl command to directly access the Kubernetes API server, as shown below.</p>
<pre><code>minikube:~$ curl https://10.160.0.3:8443/api/namespaces/default/pods/helloworld --header &quot;Authorization: Bearer $TOKEN&quot; --insecure

{
  &quot;kind&quot;: &quot;Pod&quot;,
  &quot;apiVersion&quot;: &quot;v1&quot;,
  &quot;metadata&quot;: {
    &quot;name&quot;: &quot;helloworld&quot;,
    &quot;namespace&quot;: &quot;default&quot;,
    &quot;selfLink&quot;: &quot;/api/v1/namespaces/default/pods/helloworld&quot;,
    &quot;uid&quot;: &quot;f1857174-db41-11e8-ab3f-42010aa00003&quot;,
    &quot;resourceVersion&quot;: &quot;11847&quot;,
    &quot;creationTimestamp&quot;: &quot;2018-10-29T06:14:50Z&quot;,
    &quot;labels&quot;: {
      &quot;app&quot;: &quot;helloworld&quot;
    }
  },
  &quot;spec&quot;: {
    &quot;volumes&quot;: [
      {
        &quot;name&quot;: &quot;default-token-htj76&quot;,
        &quot;secret&quot;: {
          &quot;secretName&quot;: &quot;default-token-htj76&quot;,
          &quot;defaultMode&quot;: 420
        }
      }
    ],
    &quot;containers&quot;: [
      {
        &quot;name&quot;: &quot;helloworld&quot;,
        &quot;image&quot;: &quot;gvelrajan/helloworld:v2.0&quot;,
        &quot;ports&quot;: [
          {
            &quot;containerPort&quot;: 80,
            &quot;protocol&quot;: &quot;TCP&quot;
          }
        ],
        &quot;resources&quot;: {
          
        },
        &quot;volumeMounts&quot;: [
          {
            &quot;name&quot;: &quot;default-token-htj76&quot;,
            &quot;readOnly&quot;: true,
            &quot;mountPath&quot;: &quot;/var/run/secrets/kubernetes.io/serviceaccount&quot;
          }
        ],
        &quot;terminationMessagePath&quot;: &quot;/dev/termination-log&quot;,
        &quot;terminationMessagePolicy&quot;: &quot;File&quot;,
        &quot;imagePullPolicy&quot;: &quot;Always&quot;
      }
    ],
    &quot;restartPolicy&quot;: &quot;Always&quot;,
    &quot;terminationGracePeriodSeconds&quot;: 30,
    &quot;dnsPolicy&quot;: &quot;ClusterFirst&quot;,
    &quot;serviceAccountName&quot;: &quot;default&quot;,
    &quot;serviceAccount&quot;: &quot;default&quot;,
    &quot;nodeName&quot;: &quot;minikube&quot;,
    &quot;securityContext&quot;: {
      
    },
    &quot;schedulerName&quot;: &quot;default-scheduler&quot;,
    &quot;tolerations&quot;: [
      {
        &quot;key&quot;: &quot;node.kubernetes.io/not-ready&quot;,
        &quot;operator&quot;: &quot;Exists&quot;,
        &quot;effect&quot;: &quot;NoExecute&quot;,
        &quot;tolerationSeconds&quot;: 300
      },
      {
        &quot;key&quot;: &quot;node.kubernetes.io/unreachable&quot;,
        &quot;operator&quot;: &quot;Exists&quot;,
        &quot;effect&quot;: &quot;NoExecute&quot;,
        &quot;tolerationSeconds&quot;: 300
      }
    ]
  },
  &quot;status&quot;: {
    &quot;phase&quot;: &quot;Running&quot;,
    &quot;conditions&quot;: [
      {
        &quot;type&quot;: &quot;Initialized&quot;,
        &quot;status&quot;: &quot;True&quot;,
        &quot;lastProbeTime&quot;: null,
        &quot;lastTransitionTime&quot;: &quot;2018-10-29T06:14:50Z&quot;
      },
      {
        &quot;type&quot;: &quot;Ready&quot;,
        &quot;status&quot;: &quot;True&quot;,
        &quot;lastProbeTime&quot;: null,
        &quot;lastTransitionTime&quot;: &quot;2018-10-29T06:14:55Z&quot;
      },
      {
        &quot;type&quot;: &quot;PodScheduled&quot;,
        &quot;status&quot;: &quot;True&quot;,
        &quot;lastProbeTime&quot;: null,
        &quot;lastTransitionTime&quot;: &quot;2018-10-29T06:14:50Z&quot;
      }
    ],
    &quot;hostIP&quot;: &quot;10.160.0.3&quot;,
    &quot;podIP&quot;: &quot;172.17.0.2&quot;,
    &quot;startTime&quot;: &quot;2018-10-29T06:14:50Z&quot;,
    &quot;containerStatuses&quot;: [
      {
        &quot;name&quot;: &quot;helloworld&quot;,
        &quot;state&quot;: {
          &quot;running&quot;: {
            &quot;startedAt&quot;: &quot;2018-10-29T06:14:55Z&quot;
          }
        },
        &quot;lastState&quot;: {
          
        },
        &quot;ready&quot;: true,
        &quot;restartCount&quot;: 0,
        &quot;image&quot;: &quot;gvelrajan/helloworld:v2.0&quot;,
        &quot;imageID&quot;: &quot;docker-pullable://gvelrajan/helloworld@sha256:897f0c9ec9f26b32a258f027bde0d276954dc7bf666d34cc85106cb3430c03de&quot;,
        &quot;containerID&quot;: &quot;docker://d9751038d20c827eac9bcfa94b71256b494ac442b2822b74a51312fd1ed7653d&quot;
      }
    ],
    &quot;qosClass&quot;: &quot;BestEffort&quot;
  }
}
</code></pre>
<p>Again, we get the same output from the API server.</p>
<p>To setup Authentication, Authorization and Admission Control appropriately for accessing the API Server, refer to this article in Kubernetes Documentation.</p>
<p><a href="https://kubernetes.io/docs/reference/access-authn-authz/controlling-access/">Controlling Access to the Kubernetes API Server</a></p>
<p>That&rsquo;s all folks !  Hope you got some idea on how to talk to the Kubernetes API Server directly, without using any Kubectl commands.</p>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="http://www.ethernetresearch.com/geekzone/kubernetes-how-to-install-minikube-in-a-vm/"><i class="fa fa-chevron-circle-left"></i> Kubernetes - How to Install Minikube in a VM</a>
        </li>
        
        
        <li>
            <a href="http://www.ethernetresearch.com/geekzone/kubernetes-security-user-authentication-authorization-rbac/">Kubernetes Security - User Authentication and Authorization (RBAC) <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
  
    
    
  





</main>
    <footer>
        <h6>Copyright © 2021 - Ethernet Research | All Rights Reserved.</h6>
    </footer>
</div>
<script src="http://www.ethernetresearch.com/js/scripts.js"></script>


</body>

</html>

