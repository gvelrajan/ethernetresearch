<!doctype html><html lang=en><head><title>Linux Containers - Advanced LXC Networking - Part 01 - Ethernet Research</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Ethernet Research: Actionable information about cloud technologies at your fingertips"><meta name=author content="Ganesh Velrajan"><meta property="og:title" content="Linux Containers - Advanced LXC Networking - Part 01"><meta property="og:description" content="In the previous article I discussed about some basic LXC networking concepts. In this article I&rsquo;ll discuss about the LXC configuration files that play a key role in automated provisioning of the interfaces and bridges."><meta property="og:type" content="article"><meta property="og:url" content="https://gvelrajan.github.io/ethernetresearch/geekzone/advanced-lxc-networking-part-01/"><meta property="og:image" content="https://gvelrajan.github.io/images/linux/linux-container-lxc.jpeg"><meta property="article:published_time" content="2016-11-19T00:00:00+00:00"><meta property="article:modified_time" content="2016-11-19T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gvelrajan.github.io/images/linux/linux-container-lxc.jpeg"><meta name=twitter:title content="Linux Containers - Advanced LXC Networking - Part 01"><meta name=twitter:description content="In the previous article I discussed about some basic LXC networking concepts. In this article I&rsquo;ll discuss about the LXC configuration files that play a key role in automated provisioning of the interfaces and bridges."><meta name=generator content="Hugo 0.79.1"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://gvelrajan.github.io/ethernetresearch/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=https://gvelrajan.github.io/ethernetresearch/css/styles.css></head><body><div id=container><header><h1><a href=https://gvelrajan.github.io/ethernetresearch/>Ethernet Research</a></h1><ul id=social-media><li><a href=https://linkedin.com/in/username title=LinkedIn><i class="fab fa-linkedin fa-lg"></i></a></li><li><a href=https://www.youtube.com/channel/UCnmHCstjZcevizOQ0qmANlw title=Youtube><i class="fab fa-youtube fa-lg"></i></a></li></ul><p><em>Actionable information about cloud technologies</em></p></header><nav><ul><li><a href=https://gvelrajan.github.io/ethernetresearch/geekzone/><i class="fa-li fa fa-lg"></i><span>GeekZone</span></a></li><li><a href=https://gvelrajan.github.io/ethernetresearch/articles/><i class="fa-li fa fa-lg"></i><span>Articles</span></a></li><li><a href=https://gvelrajan.github.io/ethernetresearch/about/><i class="fa-li fa fa-lg"></i><span>About Us</span></a></li><li><a href=https://gvelrajan.github.io/ethernetresearch/online-courses-training/><i class="fa-li fa fa-lg"></i><span>Online Courses</span></a></li><li><a href=https://gvelrajan.github.io/ethernetresearch/contact/><i class="fa-li fa fa-lg"></i><span>Contact</span></a></li></ul></nav><main><article><h1>Linux Containers - Advanced LXC Networking - Part 01</h1><aside><ul><li><time class=post-date datetime=2016-11-19T00:00:00Z>Nov 19, 2016</time></li><li>Categories:
<em><a href=https://gvelrajan.github.io/ethernetresearch/categories/geekzone>GeekZone</a>
,
<a href=https://gvelrajan.github.io/ethernetresearch/categories/linux-containers>Linux Containers</a>
,
<a href=https://gvelrajan.github.io/ethernetresearch/categories/networking>Networking</a></em></li><li><em><a href=https://gvelrajan.github.io/ethernetresearch/tags/linux-containers>#Linux Containers</a>
,
<a href=https://gvelrajan.github.io/ethernetresearch/tags/lxc>#LXC</a>
,
<a href=https://gvelrajan.github.io/ethernetresearch/tags/linux-networking>#Linux Networking</a></em></li><li>3 minute read</li></ul></aside><div class=featured_image><a href=https://gvelrajan.github.io/ethernetresearch/geekzone/advanced-lxc-networking-part-01/ title="Linux Containers - Advanced LXC Networking - Part 01"><img src=https://gvelrajan.github.io/ethernetresearch/images/linux/linux-container-lxc.jpeg></a></div><p>In the <a href=https://ganeshtechblog.wordpress.com/2016/11/18/linux-container-lxc-networking-fundamentals/>previous article</a> I discussed about some basic LXC networking concepts. In this article I&rsquo;ll discuss about the LXC configuration files that play a key role in automated provisioning of the interfaces and bridges.</p><h2 id=who-tells-lxc-to-create-lxcbr0->Who Tells LXC to Create lxcbr0 ?</h2><p>The answer is: <em>/var/lib/lxc/test-container/config</em>.  The file has several sections and the networking section at the bottom of the file is what we are interested in.</p><pre><code>$ sudo cat /var/lib/lxc/test-container/config
# Template used to create this container: /usr/share/lxc/templates/lxc-ubuntu
# Parameters passed to the template:
# For additional config options, please look at lxc.container.conf(5)

# Common configuration
lxc.include = /usr/share/lxc/config/ubuntu.common.conf

# Container specific configuration
lxc.rootfs = /var/lib/lxc/test-container/rootfs
lxc.mount = /var/lib/lxc/test-container/fstab
lxc.utsname = test-container
lxc.arch = amd64

# Network configuration
lxc.network.type = veth
lxc.network.flags = up
lxc.network.link = lxcbr0
lxc.network.hwaddr = 00:16:3e:b4:86:23
</code></pre><p>This is a container specific configuration file. There is a global or default configuration file at &ldquo;*/etc/lxc/default.conf&rdquo; *used by a container in the absence of a container specific configuration file.</p><pre><code>$ cat /etc/lxc/default.conf 
lxc.network.type = veth
lxc.network.link = lxcbr0
lxc.network.flags = up
lxc.network.hwaddr = 00:16:3e:xx:xx:xx
</code></pre><p>Who configures the IP address for the <em>lxcbr0</em> ? Who specifies the DHCP range for the containers connected to <em>lxcbr0</em> ? For this we need to look at file: <em>/etc/init/lxc-net.conf</em></p><pre><code>$ cat /etc/init/lxc-net.conf
description &quot;lxc network&quot;
author &quot;Serge Hallyn &lt;serge.hallyn@canonical.com&gt;&quot;

start on starting lxc
stop on stopped lxc

env USE_LXC_BRIDGE=&quot;true&quot;
env LXC_BRIDGE=&quot;lxcbr0&quot;
env LXC_ADDR=&quot;10.0.3.1&quot;
env LXC_NETMASK=&quot;255.255.255.0&quot;
env LXC_NETWORK=&quot;10.0.3.0/24&quot;
env LXC_DHCP_RANGE=&quot;10.0.3.2,10.0.3.254&quot;
env LXC_DHCP_MAX=&quot;253&quot;
env LXC_DHCP_CONFILE=&quot;&quot;
env varrun=&quot;/run/lxc&quot;
env LXC_DOMAIN=&quot;&quot;
...
...
</code></pre><p>In addition to the <em>lxcbr0</em> settings, the above file also programs the <em>iptables</em> with NAT rules(masquerade)such that the container can talk to the outside world or internet.</p><pre><code>$ sudo iptables --list -t nat
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination         
MASQUERADE  all  --  10.0.3.0/24         !10.0.3.0/24         
$ 
</code></pre><h2 id=interface-configuration-files>Interface Configuration Files:</h2><p>The interface specific configurations are stored in <em>/etc/network/interface</em>. You can edit this file to make changes to the interface configuration. In the example below, <em>eth0</em> is configured to use DHCP to talk to *lxcbr0, *acting as DHCP server, to get its IP address. However, if you want to assign a static IP address to the <em>test-container</em>, you may edit the file to do so. Changes to this file are carried across container reboot.</p><pre><code>root@test-container:/# cat /etc/network/interfaces
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp
</code></pre><p>To configure static IP address on <em>eth0</em> change the <em>eth0</em> configuration in the file to some like this:</p><pre><code>...
auto eth0
iface eth0 inet static
address 10.0.3.124
gateway 10.0.3.1
netmask 255.255.255.0
...
</code></pre></article><section class=post-nav><ul><li><a href=https://gvelrajan.github.io/ethernetresearch/geekzone/linux-container-lxc-networking-fundamentals/><i class="fa fa-chevron-circle-left"></i>Linux Container (LXC) Networking Fundamentals</a></li><li><a href=https://gvelrajan.github.io/ethernetresearch/geekzone/linux-containers-internals-lxc/>Linux Container Internals - Fundamentals of Linux Containers <i class="fa fa-chevron-circle-right"></i></a></li></ul></section></main><footer><h6>Copyright © 2021 - Ethernet Research | All Rights Reserved.</h6></footer></div><script src=https://gvelrajan.github.io/ethernetresearch/js/scripts.js></script></body></html>